sudo iptables -X
sudo iptables -F
sudo iptables -P INPUT DROP
sudo iptables -P OUTPUT DROP
sudo iptables -P FORWARD DROP
## ICMP
sudo iptables -A INPUT -i enp0s3  -p icmp -s 10.1.1.4 -d 0.0.0.0 -j ACCEPT
sudo iptables -A OUTPUT -o enp0s3 -p icmp -s 0.0.0.0 -d 10.1.1.4 -j ACCEPT

sudo iptables -A INPUT -i enp0s3 -p icmp -s 10.1.1.5 -d 0.0.0.0 -j ACCEPT
sudo iptables -A OUTPUT -o enp0s3 -p icmp -s 0.0.0.0 -d 10.1.1.5 -j ACCEPT
##
sudo iptables -A INPUT -i enp0s3 -p udp --sport 53 -j ACCEPT
sudo iptables -A OUTPUT -o enp0s3 -p udp --sport 53 -j ACCEPT
##
sudo iptables -A INPUT -i enp0s3 -p tcp --dport 80 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
sudo iptables -A OUTPUT -o enp0s3 -p tcp --sport 80 -m conntrack --ctstate ESTABLISHED -j ACCEPT
##
sudo iptables -A INPUT -i enp0s3 -p tcp --syn --dport 22 -m recent --update --seconds 60 -m connlimit --connlimit-above 1 -j REJECT
##
sudo iptables -A INPUT -i enp0s3 -p tcp -m multiport --dport 20,21 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
sudo iptables -A OUTPUT -o enp0s3 -p tcp -m multiport --sport 20,21 -m conntrack --ctstate ESTABLISHED -j ACCEPT
##
sudo iptables -A INPUT -i enp0s3 -p tcp --dport 23 -m time --timestart 08:00 --timestop 20:00 -j ACCEPT
##
sudo iptables -t nat -A POSTROUTING -o enp0s8 -j SNAT --to-source 10.1.1.1
##
sudo iptables -A FORWARD -i enp0s3 -o enp0s8 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT
sudo iptables -A FORWARD -i enp0s8 -o enp0s3 -j ACCEPT